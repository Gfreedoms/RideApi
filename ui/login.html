<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">

	<meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- to take up the width of the device-->
	<link rel="stylesheet" type="text/css" href="assets/css/styles.css">

</head>
<body >
	<div class="container">
		<div class="login-div">
			<p class="app-title">Ride My Way</p>
			<label id="server_error" class="error"></label>

			<form class="login-form" id="login_form" name="login" onsubmit="return validate_login()" method="post" action="#" >
				<div class="input-group">
					<label>Email <span id="email_error" class="error"></span></label>
					<input class="form-input" type="text" name="email" id="email">
				</div>
				<div class="input-group">
					<label>Password <span id="password_error" class="error"></span></label>
					<input class="form-input" type="Password" name="password" id="password" >
				</div>
				<div class="input-group">
				<input class="button blue login_btn" type="submit" name="submit_login" value="LOGIN"  />
				</div>
			</form>


			<p>Don't Have an Account? <u><a href="signup.html">Sign up</a></u></p>

		</div>
	</div>
</body>
<script type="text/javascript" src="assets/js/global.js"></script>
<script type="text/javascript" src="assets/js/formvalidation.js"></script>
<script type="text/javascript" src="assets/js/cookies.js"></script>

<script type="text/javascript">
	window.onload = function(){
		initialize_login_validation_elements();
		document.getElementById("server_error").style.visibility='hidden';

		var login_form = document.getElementById("login_form");
		if(login_form.addEventListener){
		    login_form.addEventListener("submit", submit_login_form, false);
		}else if(login_form.attachEvent){
		    login_form.attachEvent('onsubmit', submit_login_form);
		}

	}

	function submit_login_form(e){

		if(validate_login()){
			e.preventDefault();
			var url=SERVER_PATH+"api/v1/auth/login";
			fetch(url,{
				method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
				body:JSON.stringify({
					"email":document.getElementById("email").value,
					"password":document.getElementById("password").value
					})
			})
			.then(function(response){
				return response.json()
			})
			.then(function(data){

				if(data.status=="success"){
					//store token and redirect
					create_cookie("auth_token",data.auth_token,1);

					window.location.href = "index.html";
				}else{
					error_label=document.getElementById("server_error");
					error_label.style.visibility='visible';
					error_label.textContent=data.message
					console.log("Data ",data.message)
				}
			})
			.catch(function(error){
				console.log("Error ",error)
			})

		}
	}

</script>
</html>
